pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
a = {
  x = 64,
  y = 64,
}

b = {
  x = 80,
  y = 40,
}

c = {
  x = 90,
  y = 20,
}

d = {
  x = 100,
  y = 10,
}

-- enable mouse input
poke(0x5f2d, 1)

-- todo: this length isn't accounted for
local arm_len = 20 -- pixels
local racket_len = 20 -- pixels

function _update()
  --
  -- process mouse input.
  --

  d.x = stat(32)
  d.y = stat(33)

  --
  -- calculate target & fixed.
  --

  local len = mag({
    x = d.x - a.x,
    y = d.y - a.y,
  })

  local m = min(len, arm_len + racket_len)

  local n = normalize({
    x = d.x - a.x,
    y = d.y - a.y,
  })

  local t = {
    x = a.x + n.x*m,
    y = a.y + n.y*m,
  }

  local fixed = a

  --
  -- forward.
  --

  local new_head, new_tail = reach(c, b, t)
  c = new_head
  t = new_tail

  new_head, new_tail = reach(b, a, t)
  b = new_head
  t = new_tail

  a = t

  --
  -- backward.
  --

  new_head, new_tail = reach(a, b, fixed)
  a = new_head
  t = new_tail

  new_head, new_tail = reach(b, c, t)
  b = new_head
  t = new_tail

  c = t
end

function mag(v)
  return sqrt(v.x^2 + v.y^2)
end

function normalize(v)
 local m = mag(v)
 if m == 0 then
  return {x=0,y=0}
 end
 return {
   x = v.x/m,
   y = v.y/m,
 }
end

function round(n)
 return flr(n+0.5)
end

function _draw()
 cls()
 circfill(a.x,a.y,arm_len+racket_len,2)
 line(a.x,a.y,b.x,b.y,7)
 line(b.x,b.y,c.x,c.y,7)
 circfill(a.x,a.y,2,7)
 circfill(b.x,b.y,2,7)
 circfill(c.x,c.y,2,7)
 circfill(d.x,d.y,2,11)
end

-- return [new_head, new_tail], where new_head is now at target
-- vec3 -> vec3 -> vec3 -> Array<vec3, vec3>
function reach(head, tail, target)
  -- current len
  local x = tail.x-head.x
  local y = tail.y-head.y
  local dist = sqrt(x*x + y*y)

  -- stretched len
  local sx = tail.x-target.x
  local sy = tail.y-target.y
  local sdist = sqrt(sx*sx + sy*sy)

  -- compute scale
  local scale = dist / sdist

  -- return stuff
  local new_head = { x = target.x, y = target.y }
  local new_tail = { x = target.x + sx*scale, y = target.y + sy*scale }
  return new_head, new_tail
end
__map__
00000c00c84c12000000000032332800c84c120000000000ceccd7ff00000600c84c120000000000ceccd7ff38b3edff00000000ceccd7ff0000060038b3edff00000000ceccd7ff38b3edff00000000323328000000060038b3edff0000000032332800c84c12000000000032332800000006003c8a0f0000000000ceccd7ff
3c8a0f00000000003233280000000600c475f0ff00000000ceccd7ffc475f0ff00000000323328000000060000000000000000002e5cdcff0000000000000000ba1ef4ff000006000000eeff000000002e5cdcff00001200000000002e5cdcff000006000000eeff00000000d2a323000000120000000000d2a3230000000600
ce4ceeff0000000046e10b0032b311000000000046e10b0000000600ce4ceeff00000000ba1ef4ff32b3110000000000ba1ef4ff000006000000000000000000d2a32300000000000000000046e10b000000060000002d00ce4ceeff9c1908000000000032b311009c1908000000000000000500ce4ceeff3833070000000000
32b31100383307000000000000000500ce4ceeffd44c06000000000032b31100d44c06000000000000000500ce4ceeff706605000000000032b311007066050000000000000005003233efff32b30800000000003233efff6466050000000000000005009619f0ff32b30800000000009619f0ff646605000000000000000500
fafff0ff32b3080000000000fafff0ff6466050000000000000005005ee6f1ff32b30800000000005ee6f1ff646605000000000000000500c2ccf2ff32b3080000000000c2ccf2ff64660500000000000000050026b3f3ff32b308000000000026b3f3ff6466050000000000000005008a99f4ff32b30800000000008a99f4ff
646605000000000000000500ee7ff5ff32b3080000000000ee7ff5ff6466050000000000000005005266f6ff32b30800000000005266f6ff646605000000000000000500b64cf7ff32b3080000000000b64cf7ff6466050000000000000005001a33f8ff32b30800000000001a33f8ff6466050000000000000005007e19f9ff
32b30800000000007e19f9ff646605000000000000000500e2fff9ff32b3080000000000e2fff9ff64660500000000000000050046e6faff32b308000000000046e6faff646605000000000000000500aaccfbff32b3080000000000aaccfbff6466050000000000000005000eb3fcff32b30800000000000eb3fcff64660500
00000000000005007299fdff32b30800000000007299fdff646605000000000000000500d67ffeff32b3080000000000d67ffeff6466050000000000000005003a66ffff32b30800000000003a66ffff6466050000000000000005009e4c000032b30800000000009e4c00006466050000000000000005000233010032b30800
00000000023301006466050000000000000005006619020032b308000000000066190200646605000000000000000500caff020032b3080000000000caff02006466050000000000000005002ee6030032b30800000000002ee6030064660500000000000000050092cc040032b308000000000092cc04006466050000000000
00000500f6b2050032b3080000000000f6b205006466050000000000000005005a99060032b30800000000005a990600646605000000000000000500be7f070032b3080000000000be7f07006466050000000000000005002266080032b308000000000022660800646605000000000000000500864c090032b3080000000000
864c0900646605000000000000000500ea320a0032b3080000000000ea320a006466050000000000000005004e190b0032b30800000000004e190b00646605000000000000000500b2ff0b0032b3080000000000b2ff0b0064660500000000000000050016e60c0032b308000000000016e60c00646605000000000000000500
7acc0d0032b30800000000007acc0d00646605000000000000000500deb20e0032b3080000000000deb20e0064660500000000000000050042990f0032b308000000000042990f00646605000000000000000500a67f100032b3080000000000a67f1000646605000000000000000500ce4ceeff000009000000000032b31100
000009000000000000000700ce4ceeff0000000000000000ce4ceeff00000900000000000000080032b31100000000000000000032b31100000009000000000000000800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
